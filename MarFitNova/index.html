<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MarFitNova | Forge Your Legacy</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* --- DYNAMIC THEME ENGINE --- */
        :root {
            --primary: #b829ff; /* DEFAULT: ORIGINAL PURPLE */
            --bg: #000000;
        }

        body { margin: 0; padding: 0; background-color: var(--bg); color: white; font-family: 'Courier New', monospace; overflow-x: hidden; overflow-y: hidden; -webkit-font-smoothing: antialiased; text-rendering: optimizeLegibility; transition: transform 0.8s ease, opacity 0.8s ease; }
        body.unlocked { overflow-y: auto; }
        
        #transition-curtain { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000000; z-index: 20000; opacity: 0; pointer-events: none; transition: opacity 0.8s cubic-bezier(0.7, 0, 1, 1); }
        
        body.launching #main-site { transform: translateY(150px) scale(0.95); opacity: 0; filter: blur(10px); transition: transform 1s cubic-bezier(0.7, 0, 0.84, 0), opacity 1s ease-in, filter 1s ease-in; }
        body.launching .hero-stars { transform: scaleY(30) translateY(100px); opacity: 0.5; transition: transform 1s cubic-bezier(0.7, 0, 0.84, 0), opacity 1s ease-in; }
        body.launching #transition-curtain { opacity: 1; }

        /* NAV */
        nav { position: fixed; top: 0; left: 0; width: 100%; padding: 15px 5%; box-sizing: border-box; display: flex; justify-content: space-between; align-items: center; background: rgba(0, 0, 0, 0.95); border-bottom: 1px solid rgba(255,255,255,0.1); z-index: 5000; }
        
        .logo { 
            font-size: 1.5rem; font-weight: bold; letter-spacing: 5px; cursor: pointer; text-decoration: none; display: flex; align-items: center; gap: 10px; 
            color: var(--primary); text-shadow: 0 0 15px var(--primary); 
            transition: color 1s ease, text-shadow 1s ease; 
        }
        .logo:hover { transform: scale(1.05); }
        body.rank-singularity .logo { animation: glitchText 3s infinite alternate-reverse; }

        .comms-icon { font-size: 1rem; color: var(--primary); animation: pulseSignal 2s infinite; transition: color 1s ease; }
        
        .nav-right { display: flex; align-items: center; gap: 30px; }
        .player-stats { display: flex; align-items: center; gap: 20px; font-size: 0.8rem; color: #888; }
        .stat-box { border: 1px solid #333; padding: 5px 10px; border-radius: 4px; }
        .stat-lvl { color: var(--primary); font-weight: bold; text-shadow: 0 0 5px var(--primary); transition: color 1s ease; }
        
        .login-btn { border: 1px solid var(--primary); color: var(--primary); padding: 5px 15px; cursor: pointer; font-size: 0.8rem; transition: all 0.5s ease; }
        .login-btn:hover { background: var(--primary); color: black; box-shadow: 0 0 15px var(--primary); }
        .logout-btn { display: none; border: 1px solid #ff4400; color: #ff4400; padding: 5px 15px; cursor: pointer; font-size: 0.8rem; transition: 0.3s; }
        .logout-btn:hover { background: rgba(255, 68, 0, 0.2); box-shadow: 0 0 15px #ff4400; color: white; }
        
        ul { list-style: none; display: flex; gap: 20px; margin: 0; padding: 0; } 
        li { color: #888; cursor: pointer; transition: 0.3s; font-size: 0.9rem; } 
        li:hover { color: var(--primary); } a { text-decoration: none; color: inherit; } 

        #welcome-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100vh; background: #000; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 9999; cursor: pointer; transition: opacity 1s, visibility 1s; }
        .click-hint { position: absolute; bottom: 20%; color: white; opacity: 0.5; font-size: 0.8rem; letter-spacing: 2px; animation: blink 2s infinite; }
        .fade-in-text { font-size: 3.5rem; font-weight: 900; letter-spacing: 8px; margin: 0; opacity: 0; animation: textAppear 1s ease-out 0.5s forwards; text-shadow: 0 0 25px var(--primary); color: white; transition: text-shadow 1s ease; }
        .fade-in-subtext { font-size: 1rem; color: var(--primary); letter-spacing: 3px; opacity: 0; margin-top: 15px; animation: textAppear 1s ease-out 1.5s forwards; transition: color 1s ease; }
        
        .spark { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 0; height: 0; background: radial-gradient(circle, var(--primary) 0%, transparent 60%); border-radius: 50%; box-shadow: 0 0 60px 30px var(--primary); transition: background 1s ease; }
        .spark.active { animation: sparkExplode 1.5s ease-out forwards; }
        .flash { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 100%; height: 100%; background: white; opacity: 0; pointer-events: none; }
        .flash.active { animation: hammerFlash 0.2s ease-out; }

        #main-site { opacity: 0; min-height: 100vh; display: flex; flex-direction: column; align-items: center; transition: opacity 2s ease-in-out; }
        #main-site.visible { opacity: 1; }

        .hero { position: relative; background: linear-gradient(180deg, #0a0a0a 0%, #000000 100%); width: 100%; min-height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 120px 20px 40px; box-sizing: border-box; overflow: hidden; }
        .hero-stars { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-image: radial-gradient(white, rgba(255,255,255,.2) 2px, transparent 40px), radial-gradient(white, rgba(255,255,255,.15) 1px, transparent 30px); background-size: 550px 550px; animation: twinkle 10s infinite linear; opacity: 0.7; z-index: 0; transform-origin: center bottom; }
        
        /* Nova Blob */
        .hero-nova { 
            position: absolute; top: -100px; left: 50%; transform: translateX(-50%); width: 600px; height: 300px; 
            background: radial-gradient(ellipse at center, var(--primary) 0%, rgba(0,0,0,0) 70%); 
            filter: blur(60px); animation: novaPulse 6s ease-in-out infinite alternate; z-index: 1; opacity: 0.4; 
            transition: all 2s ease; 
        }

        /* SINGULARITY BLACK HOLE EFFECT */
        body.rank-singularity .hero-nova {
            width: 500px; height: 500px; top: -150px;
            background: radial-gradient(circle, #000 40%, var(--primary) 65%, transparent 70%);
            filter: blur(20px); opacity: 0.9;
            box-shadow: 0 0 50px rgba(106, 0, 255, 0.2);
            animation: singularitySpin 10s linear infinite;
        }

        .hero-content { position: relative; z-index: 2; margin-bottom: 20px; width: 100%; max-width: 1000px; }
        
        .meteor-spawn-container { position: relative; height: 60px; margin-bottom: 20px; display: flex; justify-content: center; align-items: flex-end; }
        .spawned-logo { font-size: 1.8rem; font-weight: 900; letter-spacing: 5px; color: white; text-shadow: 0 0 20px var(--primary); opacity: 0; transform: scale(0.5); margin: 0; transition: text-shadow 1.5s ease; }
        .hero-falling-star { position: absolute; top: -300px; left: 50%; transform: translateX(-50%); width: 3px; height: 80px; background: linear-gradient(to top, white, var(--primary), transparent); box-shadow: 0 0 20px var(--primary); opacity: 0; }
        .hero-spawn-flash { position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); width: 80px; height: 80px; background: radial-gradient(circle, white, var(--primary), transparent); opacity: 0; border-radius: 50%; }
        .hero-active .hero-falling-star { animation: heroStarFall 0.8s ease-in forwards; }
        .hero-active .hero-spawn-flash { animation: heroFlash 0.3s ease-out 0.75s forwards; }
        .hero-active .spawned-logo { animation: heroLogoReveal 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) 0.8s forwards; }

        .hero h1 { font-size: 3rem; margin-bottom: 20px; line-height: 1.2; text-transform: uppercase; letter-spacing: 3px; font-weight: 800; } 
        .hero p { color: #ccc; margin-bottom: 40px; font-size: 1rem; line-height: 1.6; letter-spacing: 1.5px; max-width: 700px; margin-left: auto; margin-right: auto; }
        
        .ignite-btn { padding: 15px 40px; background: transparent; border: 1px solid var(--primary); color: var(--primary); font-size: 0.9rem; letter-spacing: 3px; cursor: pointer; transition: 0.3s; font-family: inherit; font-weight: bold; transition: border 1.5s ease, color 1.5s ease; }
        .ignite-btn:hover { background: var(--primary); color: black; box-shadow: 0 0 25px var(--primary); }
        .ignite-btn.glowing { animation: finalIgnitionPulse 1s infinite alternate, pulseGlow 1s infinite alternate; box-shadow: 0 0 30px var(--primary); border-color: white; color: white; }

        .scroll-trigger-container { position: relative; z-index: 10; margin-top: 40px; cursor: pointer; }
        .section-subtitle { color: #888; font-size: 0.8rem; margin-bottom: 10px; letter-spacing: 1px; text-transform: uppercase; display: block; opacity: 0.8; }
        .pointer-icon { color: var(--primary); font-size: 1.8rem; animation: bouncePointer 1.5s infinite; display: block; margin: 0 auto; transition: color 1.5s ease; }
        
        #convinced-prompt { padding: 50px 0 100px; text-align: center; background: rgba(0, 0, 0, 0.9); border: none; }
        #convinced-prompt h2 { color: white; letter-spacing: 3px; margin-bottom: 30px; font-size: 1.5rem; text-shadow: 0 0 15px rgba(255, 255, 255, 0.2); }
        
        /* FIXED: CTA BUTTONS - SOLID AND STABLE */
        .cta-buttons { display: flex; justify-content: center; align-items: center; gap: 30px; height: 60px; /* Fixed height container */ }
        .cta-buttons button { 
            padding: 12px 30px; font-size: 1rem; font-weight: bold; cursor: pointer; 
            transition: all 0.2s ease-out; letter-spacing: 2px; min-width: 120px; border-radius: 4px; 
            transform: translateZ(0); /* Force GPU */
        }
        .btn-yes { 
            background: var(--primary); /* SOLID COLOR, NO GRADIENT */
            color: black; 
            border: 2px solid var(--primary); 
            box-shadow: 0 0 20px var(--primary); 
            z-index: 20; 
            position: relative;
        }
        .btn-yes:hover { transform: scale(1.1); box-shadow: 0 0 40px var(--primary); }
        .btn-no { background: transparent; color: #555; border: 1px solid #333; z-index: 10; }
        .btn-no:hover { background: rgba(255, 0, 0, 0.1); border-color: #ff0000; color: #ff0000; }

        .why-section { padding: 100px 0; background: #000; text-align: center; width: 100%; }
        .section-title { font-size: 1.8rem; margin-bottom: 60px; letter-spacing: 5px; color: #fff; transition: color 0.5s ease-out; overflow: hidden; white-space: nowrap; margin: 0 auto 60px; width: 0; max-width: 80%; padding-bottom: 5px; }
        .section-title.animated { animation: smoothTyping 3s linear forwards; text-shadow: 0 0 5px rgba(255, 255, 255, 0.5); }
        .highlight-text { color: #888; transition: color 0.5s, text-shadow 0.5s; }
        .highlight-text.active { color: var(--primary) !important; text-shadow: 0 0 10px var(--primary); }
        .grid-compare { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; width: 90%; margin: 0 auto; }
        .compare-box { background: rgba(0, 0, 0, 0.8); border: 1px solid #333; padding: 40px 20px; transition: 0.3s; opacity: 0; transform: scale(0.9); height: auto; min-height: 250px; display: flex; flex-direction: column; justify-content: space-between; will-change: transform, opacity; }
        .compare-box.visible { opacity: 1; transform: scale(1); transition: opacity 0.5s, transform 0.5s; }
        .compare-box:hover { border-color: var(--primary); box-shadow: 0 0 30px var(--primary); transform: translateY(-5px); }
        .comp-title { font-size: 1rem; color: var(--primary); margin-bottom: 15px; letter-spacing: 2px; }
        .comp-desc { color: #888; font-size: 0.85rem; line-height: 1.6; }
        .comp-icon { font-size: 2.5rem; margin-bottom: 25px; display: inline-block; }
        .icon-game { color: var(--primary); animation: gameTilt 2s ease-in-out infinite; }
        .icon-atom { color: var(--primary); animation: atomSpinSmall 4s linear infinite; }
        .icon-rocket { color: var(--primary); animation: rocketFloatSmall 2s ease-in-out infinite; }

        .architect-section { display: flex; width: 100%; height: 500px; border-top: 1px solid #222; border-bottom: 1px solid #222; }
        .split { flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: flex-start; padding-left: 10%; transition: all 0.5s ease; position: relative; overflow: hidden; cursor: crosshair; }
        .split:hover { flex: 2; } 
        .blacksmith-side { background: linear-gradient(135deg, #0a0a0a 0%, #000000 100%); border-right: 1px solid #333; } 
        .engineer-side { background: linear-gradient(135deg, #0a0a0a 0%, #000000 100%); }
        .split h2 { font-size: 2.2rem; z-index: 2; letter-spacing: 3px; overflow: hidden; white-space: nowrap; border-right: 2px solid transparent; width: 0; margin: 0 0 10px 0; max-width: 100%; text-align: left; }
        .split h2.animated { animation: smoothTyping 0.7s linear forwards; text-shadow: 0 0 5px rgba(255, 255, 255, 0.5); }
        .split p { max-width: 300px; text-align: left; color: #aaa; z-index: 2; line-height: 1.6; transition: all 0.5s; font-size: 0.9rem; } 
        .split p.active { color: var(--primary); text-shadow: 0 0 10px var(--primary); }
        .split-icon { font-size: 6rem; opacity: 0.3; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); transition: 0.3s; }
        .split:hover .split-icon { opacity: 0.8; transform: translate(-50%, -50%) scale(1.3); text-shadow: 0 0 30px currentColor; }
        .icon-hands { color: var(--primary); animation: meteorFloat 3s ease-in-out infinite; } 
        .atom-container { width: 120px; height: 120px; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); display: flex; justify-content: center; align-items: center; opacity: 0.5; transition: 0.3s; }
        .split:hover .atom-container { opacity: 1; transform: translate(-50%, -50%) scale(1.3); }
        .atom-core { width: 15px; height: 15px; background: var(--primary); border-radius: 50%; box-shadow: 0 0 15px var(--primary); }
        .electron { position: absolute; width: 100%; height: 100%; border-radius: 50%; border: 2px solid var(--primary); border-top-color: transparent; border-bottom-color: transparent; }
        .elec-1 { animation: spin1 2s linear infinite; } .elec-2 { animation: spin2 2s linear infinite; } .elec-3 { animation: spin3 2s linear infinite; }

        .login-overlay, .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.95); backdrop-filter: blur(10px); z-index: 10000; display: flex; justify-content: center; align-items: center; opacity: 0; visibility: hidden; transition: 0.3s; }
        .login-overlay.open, .modal-overlay.open { opacity: 1; visibility: visible; }
        .login-box, .modal-box { background: #0a0a0a; border: 1px solid var(--primary); padding: 40px; width: 300px; text-align: center; position: relative; box-shadow: 0 0 50px var(--primary); z-index: 10001; }
        .login-title, .modal-title { font-size: 1.2rem; letter-spacing: 3px; margin-bottom: 30px; color: white; border-bottom: 1px solid #333; padding-bottom: 10px; }
        .login-title { color: var(--primary); border-color: var(--primary); }
        .login-input { width: 100%; padding: 15px; background: rgba(255,255,255,0.05); border: 1px solid #333; color: white; margin-bottom: 15px; font-family: inherit; text-align: center; letter-spacing: 2px; }
        .submit-btn { width: 100%; padding: 15px; background: var(--primary); color: black; font-weight: bold; cursor: pointer; border: none; letter-spacing: 2px; }
        .social-btn { display: block; width: 100%; padding: 15px 0; margin-bottom: 15px; background: transparent; border: 1px solid #333; color: #888; text-decoration: none; letter-spacing: 2px; font-size: 0.9rem; transition: 0.3s; }
        .social-btn:hover { border-color: var(--primary); color: var(--primary); background: rgba(255, 255, 255, 0.05); }
        .close-login, .close-btn { position: absolute; top: 10px; right: 15px; font-size: 1.5rem; cursor: pointer; color: #555; transition: 0.3s; }
        .close-login:hover, .close-btn:hover { color: white; }
        .toggle-auth-mode { margin-top: 15px; font-size: 0.7rem; color: #888; cursor: pointer; text-decoration: underline; letter-spacing: 1px; }
        .toggle-auth-mode:hover { color: white; }

        /* --- UPDATED MINIMAL ALERT --- */
        #denied-alert {
            position: fixed; top: 15%; left: 50%; transform: translateX(-50%);
            background: #000; border: 1px solid #ff0000;
            padding: 15px 40px; text-align: center; color: #ff0000;
            font-size: 1rem; font-weight: bold; letter-spacing: 3px;
            box-shadow: 0 0 20px rgba(255, 0, 0, 0.3); z-index: 30000;
            opacity: 0; visibility: hidden; transition: opacity 0.3s;
        }
        #denied-alert.visible { opacity: 1; visibility: visible; }

        @keyframes textAppear { from { opacity: 0; transform: translateX(-10px); } to { opacity: 1; transform: translateX(0); } }
        @keyframes sparkExplode { to { width: 1500px; height: 1500px; opacity: 0; } }
        @keyframes hammerFlash { 0% { opacity: 0; } 50% { opacity: 1; } 100% { opacity: 0; } }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }
        @keyframes twinkle { from { background-position: 0 0; } to { background-position: -100px 100px; } }
        @keyframes novaPulse { 0% { opacity: 0.5; transform: translateX(-50%) scale(1); } 100% { transform: translateX(-50%) scale(1.2); } }
        @keyframes singularitySpin { 0% { transform: translateX(-50%) rotate(0deg); } 100% { transform: translateX(-50%) rotate(360deg); } }
        @keyframes glitchText { 0% { text-shadow: 0 0 15px var(--primary); } 20% { text-shadow: 3px 0 15px red, -3px 0 15px blue; } 40% { text-shadow: 0 0 15px var(--primary); } 60% { opacity: 0.8; } 100% { opacity: 1; text-shadow: 0 0 15px var(--primary); } }
        @keyframes meteorFloat { 0%, 100% { transform: translate(-50%, -50%) rotate(-10deg); } 50% { transform: translate(-50%, -60%) rotate(10deg); } }
        @keyframes spin1 { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes spin2 { 0% { transform: rotate(60deg) rotateX(60deg) rotate(0deg); } 100% { transform: rotate(60deg) rotateX(60deg) rotate(360deg); } }
        @keyframes spin3 { 0% { transform: rotate(-60deg) rotateX(60deg) rotate(0deg); } 100% { transform: rotate(-60deg) rotateX(60deg) rotate(360deg); } }
        @keyframes gameTilt { 0%, 100% { transform: rotate(-10deg); } 50% { transform: rotate(10deg); } }
        @keyframes atomSpinSmall { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes rocketFloatSmall { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        @keyframes bouncePointer { 0%, 20%, 50%, 80%, 100% { transform: translateY(0); } 40% { transform: translateY(15px); } 60% { transform: translateY(7px); } }
        @keyframes heroStarFall { 0% { top: -300px; opacity: 1; } 80% { opacity: 1; } 100% { top: 10px; opacity: 0; } }
        @keyframes heroFlash { 0% { opacity: 1; transform: translateX(-50%) scale(0); } 100% { opacity: 0; transform: translateX(-50%) scale(2); } }
        @keyframes heroLogoReveal { 0% { opacity: 0; transform: scale(0.5); filter: blur(10px); } 100% { opacity: 1; transform: scale(1); filter: blur(0); } }
        @keyframes pulseSignal { 0% { opacity: 0.5; transform: scale(1); text-shadow: 0 0 0 var(--primary); } 50% { opacity: 1; transform: scale(1.2); text-shadow: 0 0 10px var(--primary); } 100% { opacity: 0.5; transform: scale(1); text-shadow: 0 0 0 var(--primary); } }
        @keyframes finalIgnitionPulse { 0% { transform: scale(1); } 100% { transform: scale(1.05); } }
        @keyframes pulseGlow { 0% { box-shadow: 0 0 15px var(--primary); } 100% { box-shadow: 0 0 40px var(--primary); } }
        @keyframes smoothTyping { from { width: 0 } to { width: 100% } }
        @keyframes shake { 0% { transform: translateX(0); } 25% { transform: translateX(-10px); } 50% { transform: translateX(10px); } 75% { transform: translateX(-10px); } 100% { transform: translateX(0); } }
    </style>
</head>
<body onclick="ignite()">

    <script>
        // --- THEME ENGINE ---
        function getUserPrefix() {
            return localStorage.getItem('mfn_user') ? (localStorage.getItem('mfn_user') + '_') : 'GUEST_';
        }

        function applyTheme() {
            let color = '#b829ff'; 
            document.body.classList.remove('rank-singularity'); 

            if (localStorage.getItem('mfn_authenticated') === 'true') {
                let prefix = getUserPrefix();
                let lvl = parseInt(localStorage.getItem(prefix + 'mfn_level') || '1');
                
                if(lvl >= 21) color = '#ffd700'; 
                else if(lvl >= 16) {
                    color = '#6a00ff'; 
                    document.body.classList.add('rank-singularity'); 
                }
                else if(lvl >= 11) color = '#00e5ff'; 
                else if(lvl >= 6) color = '#ff4400'; 
            }
            document.documentElement.style.setProperty('--primary', color);
        }
        applyTheme(); 

        // --- AUTH CHECK IMMEDIATELY TO PREVENT FLICKER ---
        (function checkAuthImmediate() {
            if(localStorage.getItem('mfn_authenticated') === 'true') {
                // Pre-load logic is handled in window.onload for fuller DOM access
            }
        })();

        if (sessionStorage.getItem('mfn_intro_seen') === 'true') {
            document.write('<style>#welcome-screen { display: none !important; } #main-site { opacity: 1 !important; }</style>');
            window.addEventListener('load', function() {
                var heroContent = document.querySelector('.hero-content');
                if(heroContent) heroContent.classList.add('hero-active');
                
                if(localStorage.getItem('mfn_authenticated') === 'true') {
                    let savedName = localStorage.getItem('mfn_user');
                    let btn = document.getElementById("loginBtn");
                    btn.innerText = "COMMANDER " + savedName.toUpperCase();
                    btn.style.borderColor = "#00ff00";
                    btn.style.color = "#00ff00";
                    document.getElementById("logoutBtn").style.display = "block";
                    
                    let prefix = getUserPrefix();
                    document.getElementById("navLevel").innerText = localStorage.getItem(prefix + 'mfn_level') || 1;
                    document.getElementById("navXP").innerText = localStorage.getItem(prefix + 'mfn_xp') || 0;
                } else {
                    document.getElementById("navLevel").innerText = 1;
                    document.getElementById("navXP").innerText = 0;
                }
            });
        }
    </script>

    <audio id="hammerSound" src="https://www.myinstants.com/media/sounds/anvil-hit_1.mp3"></audio>

    <div id="transition-curtain"></div>

    <div id="denied-alert">
        [ LOCKED ] &nbsp; AUTHENTICATION REQUIRED
    </div>

    <div id="loginModal" class="login-overlay">
        <div class="login-box">
            <span class="close-login" onclick="toggleLogin(event)">&times;</span>
            <div class="login-title" id="authTitle">BIOMETRIC SCAN</div>
            
            <input type="password" id="codeOnlyInput" class="login-input" placeholder="ENTER ACCESS CODE">
            
            <input type="text" id="usernameInput" class="login-input" placeholder="CALLSIGN" style="display:none;">
            <input type="password" id="regCodeInput" class="login-input" placeholder="SUBSCRIPTION CODE" style="display:none;">

            <button class="submit-btn" id="actionBtn" onclick="handleAuth()">IDENTIFY</button>
            <div id="loginMsg" style="color: red; margin-top: 10px; font-size: 0.8rem; display: none;">ACCESS DENIED</div>
            
            <div class="toggle-auth-mode" id="authToggleLink" onclick="toggleAuthMode()">NEW RECRUIT? REGISTER</div>
        </div>
    </div>

    <div id="contactModal" class="modal-overlay">
        <div class="modal-box">
            <span class="close-btn" onclick="toggleContact(event)">&times;</span>
            <div class="modal-title">COMMS LINK</div>
            <a href="#" class="social-btn whatsapp">WHATSAPP</a>
            <a href="#" class="social-btn instagram">INSTAGRAM</a>
            <a href="#" class="social-btn">TIKTOK</a>
        </div>
    </div>

    <div id="welcome-screen">
        <div class="click-hint">[ CLICK TO IGNITE ]</div>
        <div class="hammer-effect"><div class="spark" id="sparkAnim"></div><div class="flash" id="flashAnim"></div></div>
        <div class="content-container">
            <h1 class="fade-in-text">MARFITNOVA</h1>
            <p class="fade-in-subtext">IGNITE YOUR POTENTIAL.</p>
        </div>
    </div>

    <div id="main-site">
        <nav id="navbar">
            <div class="logo" onclick="toggleContact(event)" title="OPEN COMMS">
                MFN <i class="fa-solid fa-tower-broadcast comms-icon"></i>
            </div>
            <div class="nav-right">
                <div class="player-stats">
                    <div class="stat-box">LVL <span id="navLevel" class="stat-lvl">1</span></div>
                    <div class="stat-box">XP <span id="navXP">0</span></div>
                </div>
                <div class="login-btn" id="loginBtn" onclick="toggleLogin(event)">[ IDENTIFY ]</div>
                <div class="logout-btn" id="logoutBtn" onclick="logoutUser()">[ DISCONNECT ]</div>
                <ul>
                    <li><a href="#" onclick="checkAccess(event, 'ascension.html')" style="color: #ffd700;">RANKS</a></li>
                    <li><a href="#" onclick="checkAccess(event, 'lab.html')">LAB</a></li>
                    <li><a href="plans.html">PLANS</a></li>
                </ul>
            </div>
        </nav>
        
        <div class="hero">
            <div class="hero-stars"></div><div class="hero-nova"></div>
            <div class="hero-content">
                <div class="meteor-spawn-container">
                    <div class="hero-falling-star"></div>
                    <div class="hero-spawn-flash"></div>
                    <h2 class="spawned-logo">MARFITNOVA</h2>
                </div>
                <h1 id="hero-heading">WHERE YOUR LIGHT NEVER FADES.<br>SHINE FOR THE LIMITLESS.</h1>
                <p>Every rep is a calculation. Every meal is fuel.<br>No wasted motion. No room for error.</p>
                <button id="ignite-button" class="ignite-btn" onclick="startSmoothLaunch()">START THE IGNITION</button>
            </div>
            <div class="scroll-trigger-container" onclick="startGuidedScroll()">
                <h2 class="section-subtitle">NOT SURE? HERE ARE A FEW REASONS THAT DIFFERENTIATE US FROM OTHER FITNESS WEBSITES.</h2>
                <div style="cursor: pointer;">
                    <span class="scroll-prompt">TAP THE ARROW TO CONTINUE</span>
                    <i class="fa-solid fa-chevron-down pointer-icon"></i>
                </div>
            </div>
        </div>

        <section class="why-section" id="why-marfitnova" style="display:none;">
            <h2 class="section-title" id="why-marfitnova-title">WHY MARFITNOVA?</h2>
            <div class="why-section-content" id="why-content">
                <div class="grid-compare">
                    <div class="compare-box" id="card-game">
                        <div class="comp-icon"><i class="fa-solid fa-gamepad icon-game"></i></div>
                        <div class="comp-title highlight-text">GAMIFIED DOPAMINE</div>
                        <div class="comp-desc highlight-text">Traditional gyms are boring. We use RPG mechanics (XP, Loot, Levels) to addict you to progress.</div>
                    </div>
                    <div class="compare-box" id="card-atom">
                        <div class="comp-icon"><i class="fa-solid fa-atom icon-atom"></i></div>
                        <div class="comp-title highlight-text">PHYSICS BASED</div>
                        <div class="comp-desc highlight-text">No bro-science. Every movement is calculated based on biomechanical leverage and tension.</div>
                    </div>
                    <div class="compare-box" id="card-rocket">
                        <div class="comp-icon"><i class="fa-solid fa-shuttle-space icon-rocket"></i></div>
                        <div class="comp-title highlight-text">INFINITE SCALING</div>
                        <div class="comp-desc highlight-text">The system adapts. From Rookie to Singularity, the difficulty scales with your capacity.</div>
                    </div>
                </div>
            </div>
        </section>

        <section class="architect-section" id="architect-section" style="display:none;">
            <div class="architect-content" id="architect-content"></div>
            <div class="split blacksmith-side">
                <div class="split-icon icon-hands">☄️</div>
                <h2 id="hands-title">THE HANDS</h2>
                <p id="hands-desc" class="highlight-text">The machine must be built. Iron requires heat, pressure, and the physical act of forging the vessel.</p>
            </div>
            <div class="split engineer-side">
                <div class="atom-container"><div class="atom-core"></div><div class="electron elec-1"></div><div class="electron elec-2"></div><div class="electron elec-3"></div></div>
                <h2 id="mind-title">THE MIND</h2>
                <p id="mind-desc" class="highlight-text">Strategy and trajectory. We don't guess. We calculate vector forces and metabolic rates for maximum lift.</p>
            </div>
        </section>
        
        <section id="convinced-prompt" style="display:none;">
            <h2>CONVINCED YET?</h2>
            <div class="cta-buttons">
                <button class="btn-yes" onclick="returnToIgnition()">YES</button>
                <button class="btn-no" onclick="handleNo(this)">NO</button>
            </div>
        </section>

    </div>

    <script>
        // --- CORE FUNCTIONS ---
        function ignite() {
            var welcome = document.getElementById("welcome-screen");
            var main = document.getElementById("main-site");
            var heroContent = document.querySelector('.hero-content');
            if(getComputedStyle(welcome).display === "none") return;
            var audio = document.getElementById("hammerSound");
            if(audio) { audio.volume = 0.5; audio.play().catch(e => console.log("Audio Error:", e)); }
            document.getElementById("sparkAnim").classList.add('active');
            document.getElementById("flashAnim").classList.add('active');
            sessionStorage.setItem('mfn_intro_seen', 'true');
            setTimeout(() => {
                welcome.style.opacity = 0;
                welcome.style.visibility = 'hidden';
                main.classList.add('visible');
                if(heroContent) heroContent.classList.add('hero-active');
                
                // LOAD DATA ON IGNITE
                // This ensures if you were already logged in, the level/xp show up instantly on ignition
                if(localStorage.getItem('mfn_authenticated') === 'true') {
                    let prefix = getUserPrefix();
                    document.getElementById("navLevel").innerText = localStorage.getItem(prefix + 'mfn_level') || 1;
                    document.getElementById("navXP").innerText = localStorage.getItem(prefix + 'mfn_xp') || 0;
                }
                
                setTimeout(() => { welcome.style.display = "none"; }, 1000);
            }, 800);
        }

        const scrollTargets = [ { id: 'why-marfitnova', type: 'section' }, { id: 'architect-section', type: 'split-hands' }, { id: 'architect-section', type: 'split-mind' }, { id: 'convinced-prompt', type: 'cta' } ];
        let currentScrollIndex = 0; let isScrolling = false;
        const DURATION_SCROLL = 700; const DURATION_TYPING = 1500; const DURATION_HIGHLIGHT_CARD = 400; const DURATION_PAUSE_BEFORE_SCROLL = 400; const DURATION_CTA_APPEAR_DELAY = 400; const DURATION_CTA_SCROLL_DELAY = 400;
        
        function startGuidedScroll() { if (isScrolling) return; isScrolling = true; currentScrollIndex = 0; document.getElementById('why-marfitnova').style.display = 'block'; document.getElementById('architect-section').style.display = 'flex'; document.body.classList.add('unlocked'); setTimeout(processScrollStep, 100); }
        function processScrollStep() { if (currentScrollIndex >= scrollTargets.length) { isScrolling = false; return; } const target = scrollTargets[currentScrollIndex]; const targetElement = document.getElementById(target.id === 'hands-title' || target.id === 'mind-title' ? 'architect-section' : target.id); if (targetElement) { let targetOffsetFinal = targetElement.offsetTop - 100; if (target.type.startsWith('split') || target.type === 'cta') { targetOffsetFinal = document.getElementById('architect-section').offsetTop - 100; } smoothScrollTo(targetOffsetFinal, DURATION_SCROLL, () => { if (target.type === 'section') { typeWhySection(document.getElementById('why-marfitnova-title'), ['card-game', 'card-atom', 'card-rocket']); } else if (target.type === 'split-hands') { typeSplitPart(document.getElementById('hands-title'), document.getElementById('hands-desc')); } else if (target.type === 'split-mind') { typeSplitPart(document.getElementById('mind-title'), document.getElementById('mind-desc')); } else if (target.type === 'cta') { setTimeout(() => { document.getElementById('convinced-prompt').style.display = 'block'; setTimeout(() => { smoothScrollTo(document.body.scrollHeight, 500, () => { isScrolling = false; }); }, DURATION_CTA_SCROLL_DELAY); }, DURATION_CTA_APPEAR_DELAY); return; } }); } }
        function typeWhySection(titleElement, cardIds) { titleElement.style.width = '0'; titleElement.classList.add('animated'); setTimeout(() => { cardIds.forEach((id, index) => { setTimeout(() => { const card = document.getElementById(id); if (card) { card.classList.add('visible'); card.querySelectorAll('.highlight-text').forEach(el => el.classList.add('active')); setTimeout(() => { card.querySelectorAll('.highlight-text').forEach(el => el.classList.remove('active')); }, DURATION_HIGHLIGHT_CARD); } }, index * (DURATION_HIGHLIGHT_CARD + 100)); }); setTimeout(() => { titleElement.classList.remove('animated'); titleElement.style.borderRight = '2px solid transparent'; titleElement.style.textShadow = 'none'; currentScrollIndex++; processScrollStep(); }, DURATION_TYPING + cardIds.length * (DURATION_HIGHLIGHT_CARD + 100) + DURATION_PAUSE_BEFORE_SCROLL); }, DURATION_PAUSE_BEFORE_SCROLL); }
        function typeSplitPart(titleElement, descElement) { titleElement.style.width = '0'; titleElement.classList.add('animated'); setTimeout(() => { descElement.classList.add('active'); setTimeout(() => { descElement.classList.remove('active'); }, DURATION_HIGHLIGHT_CARD); setTimeout(() => { titleElement.classList.remove('animated'); titleElement.style.borderRight = '2px solid transparent'; currentScrollIndex++; processScrollStep(); }, DURATION_TYPING + DURATION_PAUSE_BEFORE_SCROLL); }, DURATION_PAUSE_BEFORE_SCROLL); }
        function smoothScrollTo(targetY, duration, callback) { const startY = window.scrollY; const distance = targetY - startY; const startTime = performance.now(); function easeInOutCubic(t) { return t < 0.5 ? 4 * t * t * t : 1 - Math.pow(-2 * t + 2, 3) / 2; } function step(currentTime) { const elapsed = currentTime - startTime; const progress = Math.min(elapsed / duration, 1); const easedProgress = easeInOutCubic(progress); window.scrollTo(0, startY + distance * easedProgress); if (progress < 1) { window.requestAnimationFrame(step); } else { if (callback) callback(); } } window.requestAnimationFrame(step); }
        
        let noClickCount = 0; const noTexts = ["ARE YOU SURE?", "REALLY SURE?", "ARE YOU SURE SURE?", "THE YES LOOKS PRETTIER", "100%?", "DON'T DO THIS", "JUST CLICK IT", "I'M NOT SCROLLING", "STILL HERE?", "CLICK THE PURPLE ONE", "I CAN DO THIS ALL DAY", "MY DEVELOPER IS WATCHING", "DON'T MAKE ME BEG", "PHYSICS SAYS YES", "RESISTANCE IS FUTILE", "THE BUTTON IS GROWING...", "OKAY, NOW YOU'RE JUST MEAN", "ERROR 404: NO NOT FOUND", "YOUR MOUSE WANTS IT", "FINE, I'LL WAIT."];
        
        // FIXED: EATING LOGIC
        function handleNo(btn) { 
            btn.innerText = noTexts[noClickCount % noTexts.length]; 
            noClickCount++; 
            var yesBtn = document.querySelector('.btn-yes'); 
            var currentScale = 1 + (noClickCount * 0.1); 
            yesBtn.style.transform = `scale(${currentScale})`; 

            // EAT THE NO BUTTON AFTER 5 TRIES
            if (noClickCount >= 5) {
                btn.style.display = "none";
                yesBtn.style.transform = "scale(1.5)";
                yesBtn.innerText = "GOOD CHOICE.";
                // Optional: You could recenter the yes button here via CSS if needed, 
                // but usually hiding the neighbor works well enough in flexbox.
            }
        }
        
        function returnToIgnition() { 
            var igniteBtn = document.getElementById('ignite-button'); 
            var prompt = document.getElementById('convinced-prompt'); 
            smoothScrollTo(document.getElementById('hero-heading').offsetTop - 100, 1000, () => { 
                prompt.style.display = 'none'; // Hide AFTER scroll
                igniteBtn.classList.add('glowing'); 
                document.body.classList.remove('unlocked'); 
                setTimeout(() => { 
                    igniteBtn.classList.remove('glowing'); 
                    document.body.classList.add('unlocked'); 
                    isScrolling = false; 
                }, 4000); 
            }); 
        }
        
        // --- AUTH SYSTEM ---
        let authMode = "LOGIN"; 

        function toggleLogin(event) { 
            if(event) event.stopPropagation();
            document.getElementById("contactModal").classList.remove("open");
            document.getElementById("loginModal").classList.toggle("open"); 
            if(authMode !== "LOGIN") toggleAuthMode();
        }

        function toggleAuthMode() {
            var title = document.getElementById("authTitle");
            var btn = document.getElementById("actionBtn");
            var toggleLink = document.getElementById("authToggleLink");
            var msg = document.getElementById("loginMsg");
            
            var codeOnly = document.getElementById("codeOnlyInput");
            var userIn = document.getElementById("usernameInput");
            var regCode = document.getElementById("regCodeInput");

            msg.style.display = "none";

            if (authMode === "LOGIN") {
                authMode = "SIGNUP";
                title.innerText = "INITIALIZE PROTOCOL";
                btn.innerText = "REGISTER";
                toggleLink.innerText = "RETURNING COMMANDER? IDENTIFY";
                codeOnly.style.display = "none";
                userIn.style.display = "block";
                regCode.style.display = "block";
            } else {
                authMode = "LOGIN";
                title.innerText = "BIOMETRIC SCAN";
                btn.innerText = "IDENTIFY";
                toggleLink.innerText = "NEW RECRUIT? REGISTER";
                codeOnly.style.display = "block";
                userIn.style.display = "none";
                regCode.style.display = "none";
            }
        }

        function handleAuth() {
            var msg = document.getElementById("loginMsg");
            var db = JSON.parse(localStorage.getItem("mfn_users_db") || "{}");

            if (authMode === "SIGNUP") {
                var user = document.getElementById("usernameInput").value.trim().toUpperCase();
                var code = document.getElementById("regCodeInput").value.trim();
                
                if (!user || !code) { showError("ALL FIELDS REQUIRED"); return; }
                if (db[code]) { showError("CODE ALREADY REGISTERED. PLEASE LOGIN."); return; }
                
                // SAVE USER (Code -> Username)
                db[code] = { username: user }; 
                localStorage.setItem("mfn_users_db", JSON.stringify(db));
                
                // INITIALIZE NEW USER DATA (Level 1, XP 0)
                let prefix = user + '_';
                localStorage.setItem(prefix + 'mfn_level', 1);
                localStorage.setItem(prefix + 'mfn_xp', 0);
                
                completeLogin(user);
            } 
            else {
                // LOGIN (Code Only)
                var code = document.getElementById("codeOnlyInput").value.trim();
                if (!code) { showError("ACCESS CODE REQUIRED"); return; }
                
                if (db[code]) {
                    completeLogin(db[code].username);
                } else {
                    showError("INVALID CODE. ACCESS DENIED.");
                }
            }
        }

        function completeLogin(username) {
            localStorage.setItem("mfn_authenticated", "true");
            localStorage.setItem("mfn_user", username);
            
            var msg = document.getElementById("loginMsg");
            msg.innerText = "ACCESS GRANTED";
            msg.style.color = "#00ff00";
            msg.style.display = "block";
            
            setTimeout(() => { location.reload(); }, 1000);
        }

        function showError(text) {
            var msg = document.getElementById("loginMsg");
            msg.innerText = text;
            msg.style.color = "red";
            msg.style.display = "block";
            var box = document.querySelector('.login-box');
            box.style.animation = "shake 0.5s";
            setTimeout(() => { box.style.animation = "none"; }, 500);
        }

        function toggleContact(event) { if(event) event.stopPropagation(); document.getElementById("loginModal").classList.remove("open"); var modal = document.getElementById("contactModal"); modal.classList.toggle("open"); }
        function checkAccess(e, url) { e.preventDefault(); if(localStorage.getItem('mfn_authenticated') === 'true') { window.location.href = url; } else { var alertBox = document.getElementById("denied-alert"); alertBox.classList.add("visible"); setTimeout(() => { alertBox.classList.remove("visible"); toggleLogin(); }, 1500); } }
        function logoutUser() { localStorage.removeItem("mfn_authenticated"); localStorage.removeItem("mfn_user"); location.reload(); }
        function startSmoothLaunch() { var audio = document.getElementById("hammerSound"); if(audio) { audio.currentTime = 0; audio.play(); } document.body.classList.add('launching'); setTimeout(() => { window.location.href = 'plans.html'; }, 1000); }
    </script>
</body>
</html>